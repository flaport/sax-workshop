
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sax Workshop &#8212; Sax Workshop</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="application/vnd.jupyter.widget-state+json">{"state": {"f8f8d3185ed2466f8fce7ab9342e7c35": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "96b91ef82dd440b2b08187c30fce8bb4": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "4d4b62b4a1304669b99f521daef15ded": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "danger", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_f8f8d3185ed2466f8fce7ab9342e7c35", "max": 500.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_96b91ef82dd440b2b08187c30fce8bb4", "tabbable": null, "tooltip": null, "value": 0.0}}, "b859fa96af3d48f6a715099d7d952c0c": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "7b94ee79400e455d9705797b96905889": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "d9dc3755e99642a086f1821bf2b23ce6": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_b859fa96af3d48f6a715099d7d952c0c", "placeholder": "\u200b", "style": "IPY_MODEL_7b94ee79400e455d9705797b96905889", "tabbable": null, "tooltip": null, "value": "\u2007\u20070%"}}, "271d9a06d8064a329178051e0413bd57": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "27b9718768474c4888108c2d85b9dbae": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "32af88053044455690a7add771be3925": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_271d9a06d8064a329178051e0413bd57", "placeholder": "\u200b", "style": "IPY_MODEL_27b9718768474c4888108c2d85b9dbae", "tabbable": null, "tooltip": null, "value": "\u20070/500\u2007[00:00&lt;?,\u2007?it/s]"}}, "b7e75536d50341edb111d731338700fa": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "f7da34e7ad054e1d86586de456cad690": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_d9dc3755e99642a086f1821bf2b23ce6", "IPY_MODEL_4d4b62b4a1304669b99f521daef15ded", "IPY_MODEL_32af88053044455690a7add771be3925"], "layout": "IPY_MODEL_b7e75536d50341edb111d731338700fa", "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script crossorigin="anonymous" data-jupyter-widgets-cdn="https://cdn.jsdelivr.net/npm/" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.6/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'sax_workshop';</script>
    <link rel="canonical" href="https://github.com/flaport/sax-workshop/sax_workshop.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Sax Workshop - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Sax Workshop - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    Sax Workshop
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/flaport/sax-workshop/blob/main/sax_workshop.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/flaport/sax-workshop" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/flaport/sax-workshop/edit/main/sax_workshop.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/flaport/sax-workshop/issues/new?title=Issue%20on%20page%20%2Fsax_workshop.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/sax_workshop.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Sax Workshop</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Sax Workshop</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scatter-dictionaries">Scatter <em>dictionaries</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-model-the-coupler">A first Model: the coupler</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-second-model-the-straight-waveguide">A second model: the straight waveguide</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-circuit-the-simple-mzi">A first circuit: the simple mzi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-simulation-wavelength-sweep-of-the-simple-mzi">A first simulation: wavelength sweep of the simple mzi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-layout-mzi-with-heater">A first layout: MZI with heater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-better-waveguide-model">A better waveguide model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#euler-bend">Euler Bend</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#heater">Heater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mmi2x2">MMI2x2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-mzi-with-heater">Simulate: MZI with heater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimize-mzi-with-heater">Optimize: MZI with heater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-optimization-optimization-of-the-mzi-with-heater-with-scipy-minimize">Alternative Optimization: optimization of the mzi with heater with scipy.minimize</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-simulation-of-the-mzi">Monte Carlo Simulation of the MZI</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-broadcasting-in-python">Extra: broadcasting in python</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-with-none">Indexing with None</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#broadcasting-dimensions-with-size-1">Broadcasting dimensions with size 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-circuits">Hierarchical circuits</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sax-workshop">
<h1>Sax Workshop<a class="headerlink" href="#sax-workshop" title="Link to this heading">#</a></h1>
<blockquote>
<div><p>Virtual workshop given for the University of Illinois - 2024.11.14</p>
</div></blockquote>
<section id="scatter-dictionaries">
<h2>Scatter <em>dictionaries</em><a class="headerlink" href="#scatter-dictionaries" title="Link to this heading">#</a></h2>
<p>The core datastructure for specifying scatter parameters in SAX is a dictionary… more specifically a dictionary which maps a port combination (2-tuple) to a scatter parameter (or an array of scatter parameters when considering multiple wavelengths for example). Such a specific dictionary mapping is called ann <code class="docutils literal notranslate"><span class="pre">SDict</span></code> in SAX (<code class="docutils literal notranslate"><span class="pre">SDict</span> <span class="pre">≈</span> <span class="pre">Dict[Tuple[str,str],</span> <span class="pre">float]</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">in1</span>          <span class="n">out1</span>
   \        <span class="o">/</span>
    <span class="o">========</span>
   <span class="o">/</span>        \
<span class="n">in0</span>          <span class="n">out0</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coupling</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="n">coupling</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">tau</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">coupling</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
<span class="n">coupler_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">):</span> <span class="n">tau</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;out0&quot;</span><span class="p">,</span> <span class="s2">&quot;in0&quot;</span><span class="p">):</span> <span class="n">tau</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out1&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;out1&quot;</span><span class="p">,</span> <span class="s2">&quot;in0&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;in1&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;out0&quot;</span><span class="p">,</span> <span class="s2">&quot;in1&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;in1&quot;</span><span class="p">,</span> <span class="s2">&quot;out1&quot;</span><span class="p">):</span> <span class="n">tau</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;out1&quot;</span><span class="p">,</span> <span class="s2">&quot;in1&quot;</span><span class="p">):</span> <span class="n">tau</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">coupler_dict</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{(&#39;in0&#39;, &#39;out0&#39;): 0.7071067811865476,
 (&#39;out0&#39;, &#39;in0&#39;): 0.7071067811865476,
 (&#39;in0&#39;, &#39;out1&#39;): 0.7071067811865476j,
 (&#39;out1&#39;, &#39;in0&#39;): 0.7071067811865476j,
 (&#39;in1&#39;, &#39;out0&#39;): 0.7071067811865476j,
 (&#39;out0&#39;, &#39;in1&#39;): 0.7071067811865476j,
 (&#39;in1&#39;, &#39;out1&#39;): 0.7071067811865476,
 (&#39;out1&#39;, &#39;in1&#39;): 0.7071067811865476}
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<h4 class="rubric" id="advantages-of-using-a-dict-as-s-matrix-representation">Advantages of using a dict as S-Matrix representation</h4>
<ul class="simple">
<li><p>Inherently sparse (you only specify the non-zero connections)</p></li>
<li><p>Explicit in the ports</p></li>
</ul>
</div>
<p>Obviously, it can still be tedious to specify every port in the circuit manually. SAX therefore offers <code class="docutils literal notranslate"><span class="pre">sax.reciprocal()</span></code>, which auto-fills the reverse connection if the forward connection exist. For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sax</span>

<span class="n">coupler_dict</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="p">(</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">):</span> <span class="n">tau</span><span class="p">,</span>
        <span class="p">(</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out1&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span>
        <span class="p">(</span><span class="s2">&quot;in1&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span>
        <span class="p">(</span><span class="s2">&quot;in1&quot;</span><span class="p">,</span> <span class="s2">&quot;out1&quot;</span><span class="p">):</span> <span class="n">tau</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">coupler_dict</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{(&#39;in0&#39;, &#39;out0&#39;): 0.7071067811865476,
 (&#39;in0&#39;, &#39;out1&#39;): 0.7071067811865476j,
 (&#39;in1&#39;, &#39;out0&#39;): 0.7071067811865476j,
 (&#39;in1&#39;, &#39;out1&#39;): 0.7071067811865476,
 (&#39;out0&#39;, &#39;in0&#39;): 0.7071067811865476,
 (&#39;out1&#39;, &#39;in0&#39;): 0.7071067811865476j,
 (&#39;out0&#39;, &#39;in1&#39;): 0.7071067811865476j,
 (&#39;out1&#39;, &#39;in1&#39;): 0.7071067811865476}
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-first-model-the-coupler">
<h2>A first Model: the coupler<a class="headerlink" href="#a-first-model-the-coupler" title="Link to this heading">#</a></h2>
<p>Constructing such an <code class="docutils literal notranslate"><span class="pre">SDict</span></code> is easy, however, usually we’re more interested in having parametrized models for our components. To parametrize the coupler <code class="docutils literal notranslate"><span class="pre">SDict</span></code>, just wrap it in a keyword-only function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">coupler</span><span class="p">(</span><span class="n">coupling</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sax</span><span class="o">.</span><span class="n">SDict</span><span class="p">:</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">coupling</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">coupling</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="n">coupler_dict</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">):</span> <span class="n">tau</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out1&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;in1&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;in1&quot;</span><span class="p">,</span> <span class="s2">&quot;out1&quot;</span><span class="p">):</span> <span class="n">tau</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">coupler_dict</span>


<span class="n">coupler</span><span class="p">(</span><span class="n">coupling</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{(&#39;in0&#39;, &#39;out0&#39;): 0.8366600265340756,
 (&#39;in0&#39;, &#39;out1&#39;): 0.5477225575051661j,
 (&#39;in1&#39;, &#39;out0&#39;): 0.5477225575051661j,
 (&#39;in1&#39;, &#39;out1&#39;): 0.8366600265340756,
 (&#39;out0&#39;, &#39;in0&#39;): 0.8366600265340756,
 (&#39;out1&#39;, &#39;in0&#39;): 0.5477225575051661j,
 (&#39;out0&#39;, &#39;in1&#39;): 0.5477225575051661j,
 (&#39;out1&#39;, &#39;in1&#39;): 0.8366600265340756}
</pre></div>
</div>
</div>
</div>
<p>We just created a perfect coupler with a varying coupling ratio.</p>
</section>
<section id="a-second-model-the-straight-waveguide">
<h2>A second model: the straight waveguide<a class="headerlink" href="#a-second-model-the-straight-waveguide" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>  <span class="c1"># JAX-version of numpy</span>


<span class="k">def</span> <span class="nf">waveguide</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">wl0</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">neff</span><span class="o">=</span><span class="mf">2.34</span><span class="p">,</span> <span class="n">ng</span><span class="o">=</span><span class="mf">3.4</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sax</span><span class="o">.</span><span class="n">SDict</span><span class="p">:</span>
    <span class="n">dwl</span> <span class="o">=</span> <span class="n">wl</span> <span class="o">-</span> <span class="n">wl0</span>
    <span class="n">dneff_dwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">ng</span> <span class="o">-</span> <span class="n">neff</span><span class="p">)</span> <span class="o">/</span> <span class="n">wl0</span>
    <span class="n">neff</span> <span class="o">=</span> <span class="n">neff</span> <span class="o">-</span> <span class="n">dwl</span> <span class="o">*</span> <span class="n">dneff_dwl</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">neff</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="n">wl</span>
    <span class="n">transmission</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">loss</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
    <span class="n">sdict</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">):</span> <span class="n">transmission</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">sdict</span>
</pre></div>
</div>
</div>
</div>
<p>That’s pretty straightforward. Let’s now move on to parametrized circuits:</p>
</section>
<section id="a-first-circuit-the-simple-mzi">
<h2>A first circuit: the simple mzi<a class="headerlink" href="#a-first-circuit-the-simple-mzi" title="Link to this heading">#</a></h2>
<p>Existing models can now be combined into a circuit using <code class="docutils literal notranslate"><span class="pre">sax.circuit</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mzi</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">circuit</span><span class="p">(</span>
    <span class="n">netlist</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># use the model as-is:</span>
            <span class="s2">&quot;lft&quot;</span><span class="p">:</span> <span class="s2">&quot;coupler&quot;</span><span class="p">,</span>
            <span class="c1"># bake in default values for the models:</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;waveguide&quot;</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">}},</span>
            <span class="s2">&quot;btm&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;waveguide&quot;</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">}},</span>
            <span class="s2">&quot;rgt&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;coupler&quot;</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;coupling&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}},</span>
        <span class="p">},</span>
        <span class="s2">&quot;connections&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;lft,out0&quot;</span><span class="p">:</span> <span class="s2">&quot;btm,in0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;btm,out0&quot;</span><span class="p">:</span> <span class="s2">&quot;rgt,in0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lft,out1&quot;</span><span class="p">:</span> <span class="s2">&quot;top,in0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;top,out0&quot;</span><span class="p">:</span> <span class="s2">&quot;rgt,in1&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;ports&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;in0&quot;</span><span class="p">:</span> <span class="s2">&quot;lft,in0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;in1&quot;</span><span class="p">:</span> <span class="s2">&quot;lft,in1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;out0&quot;</span><span class="p">:</span> <span class="s2">&quot;rgt,out0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;out1&quot;</span><span class="p">:</span> <span class="s2">&quot;rgt,out1&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="n">models</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;coupler&quot;</span><span class="p">:</span> <span class="n">coupler</span><span class="p">,</span>
        <span class="s2">&quot;waveguide&quot;</span><span class="p">:</span> <span class="n">waveguide</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When defining the netlist for the circuit, we can choose to use the model as-is, or to bake-in some default settings.</p>
<p>Then <code class="docutils literal notranslate"><span class="pre">sax.circuit()</span></code> returns two items: <code class="docutils literal notranslate"><span class="pre">mzi</span></code> and <code class="docutils literal notranslate"><span class="pre">info</span></code>. The first one is the model <em>function</em> of the mzi. The second one returns additional info about the circuit (usually you can just ignore this).</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">mzi</span></code> is just a function I should be able to call it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mzi</span><span class="p">()</span>  <span class="c1"># indeed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{(&#39;in0&#39;, &#39;in0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in0&#39;, &#39;in1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in0&#39;, &#39;out0&#39;): Array(-0.28072841+0.10397039j, dtype=complex128),
 (&#39;in0&#39;, &#39;out1&#39;): Array(0.89474612-0.33137758j, dtype=complex128),
 (&#39;in1&#39;, &#39;in0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in1&#39;, &#39;in1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in1&#39;, &#39;out0&#39;): Array(0.89474612-0.33137758j, dtype=complex128),
 (&#39;in1&#39;, &#39;out1&#39;): Array(0.28072841-0.10397039j, dtype=complex128),
 (&#39;out0&#39;, &#39;in0&#39;): Array(-0.28072841+0.10397039j, dtype=complex128),
 (&#39;out0&#39;, &#39;in1&#39;): Array(0.89474612-0.33137758j, dtype=complex128),
 (&#39;out0&#39;, &#39;out0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out0&#39;, &#39;out1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out1&#39;, &#39;in0&#39;): Array(0.89474612-0.33137758j, dtype=complex128),
 (&#39;out1&#39;, &#39;in1&#39;): Array(0.28072841-0.10397039j, dtype=complex128),
 (&#39;out1&#39;, &#39;out0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out1&#39;, &#39;out1&#39;): Array(0.+0.j, dtype=complex128)}
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<h4 class="rubric" id="why-a-function">Why a function?</h4>
<p>You might be wondering… <em>“why does <code class="docutils literal notranslate"><span class="pre">sax.circuit()</span></code> return a function and not just an S-matrix (or S-dict)?”</em> The reason for this is that returning a <em>function</em> allows you to experiment with changing circuit parameters without having to build the circuit again. This is useful for sweeps, Monte Carlo simulations, optimizations and more</p>
</div>
<p>Let’s have a look at the mzi model parameters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">?</span>mzi
</pre></div>
</div>
</div>
</div>
<p>The circuit takes four parameters: <code class="docutils literal notranslate"><span class="pre">lft</span></code>, <code class="docutils literal notranslate"><span class="pre">top</span></code>, <code class="docutils literal notranslate"><span class="pre">btm</span></code> and <code class="docutils literal notranslate"><span class="pre">rgt</span></code>. These are the instance names of our circuit! Moreover - as you can see - each instance name maps to the parameters of the associated model.</p>
<p>This means we could parametrize our mzi as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mzi</span><span class="p">(</span><span class="n">lft</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;coupling&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="n">top</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wl&quot;</span><span class="p">:</span> <span class="mf">1.31</span><span class="p">},</span> <span class="n">btm</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wl&quot;</span><span class="p">:</span> <span class="mf">1.31</span><span class="p">},</span> <span class="n">rgt</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;coupling&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{(&#39;in0&#39;, &#39;in0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in0&#39;, &#39;in1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in0&#39;, &#39;out0&#39;): Array(-0.39696875-0.32897366j, dtype=complex128),
 (&#39;in0&#39;, &#39;out1&#39;): Array(0.85073721-0.1021682j, dtype=complex128),
 (&#39;in1&#39;, &#39;in0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in1&#39;, &#39;in1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in1&#39;, &#39;out0&#39;): Array(0.85073721-0.1021682j, dtype=complex128),
 (&#39;in1&#39;, &#39;out1&#39;): Array(0.30778904-0.41361065j, dtype=complex128),
 (&#39;out0&#39;, &#39;in0&#39;): Array(-0.39696875-0.32897366j, dtype=complex128),
 (&#39;out0&#39;, &#39;in1&#39;): Array(0.85073721-0.1021682j, dtype=complex128),
 (&#39;out0&#39;, &#39;out0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out0&#39;, &#39;out1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out1&#39;, &#39;in0&#39;): Array(0.85073721-0.1021682j, dtype=complex128),
 (&#39;out1&#39;, &#39;in1&#39;): Array(0.30778904-0.41361065j, dtype=complex128),
 (&#39;out1&#39;, &#39;out0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out1&#39;, &#39;out1&#39;): Array(0.+0.j, dtype=complex128)}
</pre></div>
</div>
</div>
</div>
<p>However, many parameter names and values are repeated. Therefore it’s sometimes more useful to call the circuit with globally defined parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mzi</span><span class="p">(</span><span class="n">coupling</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wl</span><span class="o">=</span><span class="mf">1.31</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{(&#39;in0&#39;, &#39;in0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in0&#39;, &#39;in1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in0&#39;, &#39;out0&#39;): Array(-0.39696875-0.32897366j, dtype=complex128),
 (&#39;in0&#39;, &#39;out1&#39;): Array(0.85073721-0.1021682j, dtype=complex128),
 (&#39;in1&#39;, &#39;in0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in1&#39;, &#39;in1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;in1&#39;, &#39;out0&#39;): Array(0.85073721-0.1021682j, dtype=complex128),
 (&#39;in1&#39;, &#39;out1&#39;): Array(0.30778904-0.41361065j, dtype=complex128),
 (&#39;out0&#39;, &#39;in0&#39;): Array(-0.39696875-0.32897366j, dtype=complex128),
 (&#39;out0&#39;, &#39;in1&#39;): Array(0.85073721-0.1021682j, dtype=complex128),
 (&#39;out0&#39;, &#39;out0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out0&#39;, &#39;out1&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out1&#39;, &#39;in0&#39;): Array(0.85073721-0.1021682j, dtype=complex128),
 (&#39;out1&#39;, &#39;in1&#39;): Array(0.30778904-0.41361065j, dtype=complex128),
 (&#39;out1&#39;, &#39;out0&#39;): Array(0.+0.j, dtype=complex128),
 (&#39;out1&#39;, &#39;out1&#39;): Array(0.+0.j, dtype=complex128)}
</pre></div>
</div>
</div>
</div>
<p>Globally defined parameters will distribute over any child instance parameters if the child model accepts that parameter. In practice globally defined parameters are often used for ambient parameters like wavelength (<code class="docutils literal notranslate"><span class="pre">wl</span></code>) or temperature (<code class="docutils literal notranslate"><span class="pre">T</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<h4 class="rubric" id="summary">Summary</h4>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">sax.circuit</span></code> function just returns another python function as our <em>model</em> for the newly created circuit.</p></li>
<li><p>You can ‘bake in’ default parameters within the netlist</p></li>
<li><p>You can override parameters when calling the circuit function</p></li>
<li><p>You can override parameters globally when calling a circuit function.</p></li>
</ul>
</div>
</section>
<section id="a-first-simulation-wavelength-sweep-of-the-simple-mzi">
<h2>A first simulation: wavelength sweep of the simple mzi<a class="headerlink" href="#a-first-simulation-wavelength-sweep-of-the-simple-mzi" title="Link to this heading">#</a></h2>
<p>You might be tempted to perform a wavelength sweep with a loop:</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Don’t do this!</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">S_matrices</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">wls</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">wl</span> <span class="ow">in</span> <span class="n">wls</span><span class="p">:</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">mzi</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">)</span>
    <span class="n">S_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.68 s, sys: 36.5 ms, total: 1.71 s
Wall time: 1.58 s
</pre></div>
</div>
</div>
</div>
<p>This is fairly inefficient. Moreover now you’re stuck with a list of S-dicts which are pretty hard to merge. In stead, SAX is very good at vectorizing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">mzi</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 405 ms, sys: 8.24 ms, total: 414 ms
Wall time: 375 ms
</pre></div>
</div>
</div>
</div>
<p>What’s inside this S-dictionary is just an array of S-parameters (one for each wavelength)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array([0.5145554 , 0.55503852, 0.59419548, 0.63194204, 0.66819775,
       0.7028861 , 0.73593466, 0.76727523, 0.7968439 , 0.82458121,
       0.85043223, 0.87434662, 0.89627872, 0.91618762, 0.93403717,
       0.94979605, 0.9634378 , 0.97494078, 0.98428825, 0.9914683 ,
       0.99647386, 0.99930268, 0.99995725, 0.9984448 , 0.99477719,
       0.9889709 , 0.9810469 , 0.97103059, 0.95895169, 0.94484414,
       0.92874602, 0.91069937, 0.89075011, 0.86894788, 0.84534594,
       0.82000096, 0.79297293, 0.76432497, 0.73412317, 0.70243645,
       0.66933635, 0.63489688, 0.59919435, 0.56230716, 0.52431567,
       0.48530196, 0.44534968, 0.40454384, 0.36297067, 0.32071735,
       0.27787192, 0.23452302, 0.19075973, 0.14667141, 0.10234745,
       0.05787718, 0.01334961, 0.03114669, 0.0755238 , 0.1196946 ,
       0.16357294, 0.2070738 , 0.25011345, 0.2926096 , 0.33448156,
       0.37565038, 0.41603898, 0.45557229, 0.49417738, 0.53178357,
       0.56832258, 0.60372859, 0.6379384 , 0.67089147, 0.70253007,
       0.73279933, 0.76164732, 0.78902514, 0.81488697, 0.83919014,
       0.86189516, 0.88296582, 0.90236916, 0.92007555, 0.9360587 ,
       0.95029568, 0.96276693, 0.97345628, 0.98235094, 0.98944147,
       0.99472182, 0.99818927, 0.99984442, 0.99969116, 0.99773663,
       0.99399118, 0.98846832, 0.98118468, 0.97215993, 0.96141673],      dtype=float64)
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The array of S-parameters does not need to be 1D! It can have however many dimensions as you’d like (e.g. one dimension per process parameter). This will come in handy for Monte Carlo simulations later on.</p>
</div>
<p>Let’s see what this gives:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;in0&quot;</span><span class="p">,</span> <span class="s2">&quot;out0&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;λ [nm]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;transmission&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1c92a04224bd44e810ae96cf651e4fe10149301c3b3feb96030a6a53e6064e57.png" src="_images/1c92a04224bd44e810ae96cf651e4fe10149301c3b3feb96030a6a53e6064e57.png" />
</div>
</div>
</section>
<section id="a-first-layout-mzi-with-heater">
<h2>A first layout: MZI with heater<a class="headerlink" href="#a-first-layout-mzi-with-heater" title="Link to this heading">#</a></h2>
<p>We can quite easily define out own mzi with heater in GDSFactory:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>


<span class="nd">@gf</span><span class="o">.</span><span class="n">cell</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">mzi_with_heater</span><span class="p">(</span>
    <span class="n">delta_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">heater_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
    <span class="n">heater</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">add_ref</span><span class="p">(</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_heater_metal</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">heater_length</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;heater&quot;</span>
    <span class="p">)</span>
    <span class="n">heater</span><span class="o">.</span><span class="n">dmove</span><span class="p">(</span>
        <span class="n">heater</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dcenter</span><span class="p">,</span>
        <span class="p">((</span><span class="n">width</span> <span class="o">-</span> <span class="n">heater_length</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">delta_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">btmwg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">add_ref</span><span class="p">(</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;btm_straight&quot;</span><span class="p">)</span>
    <span class="n">btmwg</span><span class="o">.</span><span class="n">dmove</span><span class="p">(</span><span class="n">btmwg</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dcenter</span><span class="p">,</span> <span class="p">((</span><span class="n">width</span> <span class="o">-</span> <span class="n">heater_length</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">add_ref</span><span class="p">(</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi2x2</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inp&quot;</span><span class="p">)</span>
    <span class="n">inp</span><span class="o">.</span><span class="n">dmove</span><span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dcenter</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inp</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dcenter</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">outp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">add_ref</span><span class="p">(</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi2x2</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outp&quot;</span><span class="p">)</span>
    <span class="n">outp</span><span class="o">.</span><span class="n">dmove</span><span class="p">(</span><span class="n">outp</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dcenter</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">outp</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dcenter</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_single</span><span class="p">(</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">port1</span><span class="o">=</span><span class="n">inp</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">],</span> <span class="n">port2</span><span class="o">=</span><span class="n">heater</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span> <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;strip&quot;</span>
    <span class="p">)</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_single</span><span class="p">(</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">port1</span><span class="o">=</span><span class="n">inp</span><span class="p">[</span><span class="s2">&quot;o4&quot;</span><span class="p">],</span> <span class="n">port2</span><span class="o">=</span><span class="n">btmwg</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span> <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;strip&quot;</span>
    <span class="p">)</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_single</span><span class="p">(</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">port1</span><span class="o">=</span><span class="n">outp</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">],</span> <span class="n">port2</span><span class="o">=</span><span class="n">heater</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">],</span> <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;strip&quot;</span>
    <span class="p">)</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_single</span><span class="p">(</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">port1</span><span class="o">=</span><span class="n">outp</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span> <span class="n">port2</span><span class="o">=</span><span class="n">btmwg</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">],</span> <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;strip&quot;</span>
    <span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add_ports</span><span class="p">([</span><span class="n">inp</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span> <span class="n">inp</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">],</span> <span class="n">outp</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">],</span> <span class="n">outp</span><span class="p">[</span><span class="s2">&quot;o4&quot;</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c_mzi1</span> <span class="o">=</span> <span class="n">mzi_with_heater</span><span class="p">()</span><span class="o">.</span><span class="n">dup</span><span class="p">()</span>
<span class="n">c_mzi1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;c_mzi1&quot;</span>  <span class="c1"># easier to reference name when working with netlists</span>
<span class="n">c_mzi1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2fbecb7875f8c92ff742264f36431c59f063eaf6c77e94a0c71c1c1762585bd8.png" src="_images/2fbecb7875f8c92ff742264f36431c59f063eaf6c77e94a0c71c1c1762585bd8.png" />
</div>
</div>
<p>GDSFactory has a built-in way to extract the netlist from a <code class="docutils literal notranslate"><span class="pre">gf.Component</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the recursive=True ensures that *all* netlists are extracted in the case of</span>
<span class="c1"># hierarchical components. This is not really relevant here but it&#39;s good practice</span>
<span class="c1"># to always include it.</span>
<span class="n">netlist</span> <span class="o">=</span> <span class="n">c_mzi1</span><span class="o">.</span><span class="n">get_netlist</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This netlist is compatible with SAX. To build our circuit we need to know which models we need:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sax</span><span class="o">.</span><span class="n">get_required_circuit_models</span><span class="p">(</span><span class="n">netlist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;bend_euler&#39;, &#39;straight&#39;, &#39;straight_heater_metal_undercut&#39;, &#39;mmi2x2&#39;]
</pre></div>
</div>
</div>
</div>
<p>Since we now have a layout to go from, let’s create some better models for those components first:</p>
</section>
<section id="a-better-waveguide-model">
<h2>A better waveguide model<a class="headerlink" href="#a-better-waveguide-model" title="Link to this heading">#</a></h2>
<p>We can use some GDSFactory utilities to create a <code class="docutils literal notranslate"><span class="pre">neff</span></code> model for our waveguide</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">gplugins.tidy3d</span> <span class="k">as</span> <span class="nn">gt</span>

<span class="n">widths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">neffs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ngs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">width</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">widths</span><span class="p">):</span>
    <span class="n">strip</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">Waveguide</span><span class="p">(</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span>
        <span class="n">core_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">core_thickness</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span>
        <span class="n">slab_thickness</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">core_material</span><span class="o">=</span><span class="s2">&quot;si&quot;</span><span class="p">,</span>
        <span class="n">clad_material</span><span class="o">=</span><span class="s2">&quot;sio2&quot;</span><span class="p">,</span>
        <span class="n">group_index_step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">neffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">n_eff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ngs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">n_group</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">neffs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">neffs</span><span class="p">))</span>
<span class="n">ngs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ngs</span><span class="p">))</span>

<span class="n">strip</span><span class="o">.</span><span class="n">plot_field</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="n">mode_index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">gplugins.tidy3d</span> <span class="k">as</span> <span class="nn">gt</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">widths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">neffs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">gplugins</span><span class="o">/</span><span class="n">tidy3d</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">gplugins.tidy3d</span> <span class="kn">import</span> <span class="n">materials</span><span class="p">,</span> <span class="n">modes</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">gplugins.tidy3d.component</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">Tidy3DComponent</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">material_name_to_medium</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">write_sparameters</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">write_sparameters_batch</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">from</span> <span class="nn">gplugins.tidy3d.get_simulation_grating_coupler</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">get_simulation_grating_coupler</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span> <span class="nn">gplugins.tidy3d.write_sparameters_grating_coupler</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="n">plot_simulation</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">write_sparameters_grating_coupler</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">write_sparameters_grating_coupler_batch</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">gplugins</span><span class="o">/</span><span class="n">tidy3d</span><span class="o">/</span><span class="n">component</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">33</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="kn">from</span> <span class="nn">tidy3d.components.types</span> <span class="kn">import</span> <span class="n">Symmetry</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="kn">from</span> <span class="nn">tidy3d.plugins.smatrix</span> <span class="kn">import</span> <span class="n">ComponentModeler</span><span class="p">,</span> <span class="n">Port</span>
<span class="ne">---&gt; </span><span class="mi">33</span> <span class="kn">from</span> <span class="nn">gplugins.common.base_models.component</span> <span class="kn">import</span> <span class="n">LayeredComponentBase</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="kn">from</span> <span class="nn">gplugins.tidy3d.get_results</span> <span class="kn">import</span> <span class="n">_executor</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="kn">from</span> <span class="nn">gplugins.tidy3d.types</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>     <span class="n">Sparameters</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>     <span class="n">Tidy3DElementMapping</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>     <span class="n">Tidy3DMedium</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">gplugins</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">base_models</span><span class="o">/</span><span class="n">component</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">16</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">BaseModel</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">ConfigDict</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">NonNegativeFloat</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="n">computed_field</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">from</span> <span class="nn">shapely</span> <span class="kn">import</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="ne">---&gt; </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">gplugins.gmsh.parse_gds</span> <span class="kn">import</span> <span class="n">cleanup_component</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">from</span> <span class="nn">..types</span> <span class="kn">import</span> <span class="n">AnyShapelyPolygon</span><span class="p">,</span> <span class="n">GFComponent</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="k">class</span> <span class="nc">LayeredComponentBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">gplugins</span><span class="o">/</span><span class="n">gmsh</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">gplugins.common.utils.parse_layer_stack</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">get_layer_overlaps_z</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">get_layers_at_z</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">order_layer_stack</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">gplugins.gmsh.get_mesh</span> <span class="kn">import</span> <span class="n">create_physical_mesh</span><span class="p">,</span> <span class="n">get_mesh</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span> <span class="nn">gplugins.gmsh.uz_xsection_mesh</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="n">get_u_bounds_layers</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">get_u_bounds_polygons</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">get_uz_bounds_layers</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">uz_xsection_mesh</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">from</span> <span class="nn">gplugins.gmsh.xy_xsection_mesh</span> <span class="kn">import</span> <span class="n">xy_xsection_mesh</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/</span><span class="n">sax</span><span class="o">-</span><span class="n">workshop</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">gplugins</span><span class="o">/</span><span class="n">gmsh</span><span class="o">/</span><span class="n">get_mesh</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">meshio</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">from</span> <span class="nn">gdsfactory</span> <span class="kn">import</span> <span class="n">Component</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">gdsfactory.typings</span> <span class="kn">import</span> <span class="n">ComponentSpec</span><span class="p">,</span> <span class="n">Layer</span><span class="p">,</span> <span class="n">LayerStack</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;meshio&#39;
</pre></div>
</div>
</div>
</div>
<p>Now we can create a very basic width v neff model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="n">m_neff</span><span class="p">,</span> <span class="n">b_neff</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">neffs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">neffs</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">m_neff</span> <span class="o">*</span> <span class="n">widths</span> <span class="o">+</span> <span class="n">b_neff</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;width [μm]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;neff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;neff @ λ=1.55μm&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">m_neff</span><span class="p">,</span> <span class="n">b_neff</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">neffs</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">neffs</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">m_neff</span> <span class="o">*</span> <span class="n">widths</span> <span class="o">+</span> <span class="n">b_neff</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;widths&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>And a width v ng model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_ng</span><span class="p">,</span> <span class="n">b_ng</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">ngs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">ngs</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">m_ng</span> <span class="o">*</span> <span class="n">widths</span> <span class="o">+</span> <span class="n">b_ng</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;width [μm]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;ng&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;neff @ λ=1.55μm&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">m_ng</span><span class="p">,</span> <span class="n">b_ng</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">ngs</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">ngs</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">m_ng</span> <span class="o">*</span> <span class="n">widths</span> <span class="o">+</span> <span class="n">b_ng</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;widths&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For actual good models we should do this mode calculation with more accuracy, more width points and probably fit a nonlinear model. However, for this tutorial we just roll with the above…</p>
</div>
<p>We can now create functions for out fits (valid at wl0=1.5μm)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">neff0</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m_neff</span> <span class="o">*</span> <span class="n">width</span> <span class="o">+</span> <span class="n">b_neff</span>


<span class="k">def</span> <span class="nf">ng0</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m_ng</span> <span class="o">*</span> <span class="n">width</span> <span class="o">+</span> <span class="n">b_ng</span>
</pre></div>
</div>
</div>
</div>
<p>We can combine these two into a single neff function which is valid for a wider wavelength range:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">neff</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="n">wl0</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">dwl</span> <span class="o">=</span> <span class="n">wl</span> <span class="o">-</span> <span class="n">wl0</span>
    <span class="n">_neff0</span> <span class="o">=</span> <span class="n">neff0</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
    <span class="n">_ng0</span> <span class="o">=</span> <span class="n">ng0</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
    <span class="n">dneff_dwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">_ng0</span> <span class="o">-</span> <span class="n">_neff0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wl0</span>
    <span class="n">neff</span> <span class="o">=</span> <span class="n">_neff0</span> <span class="o">-</span> <span class="n">dwl</span> <span class="o">*</span> <span class="n">dneff_dwl</span>
    <span class="k">return</span> <span class="n">neff</span>
</pre></div>
</div>
</div>
</div>
<p>We can plot this as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">widths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">neffs</span> <span class="o">=</span> <span class="n">neff</span><span class="p">(</span><span class="n">wls</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">widths</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="n">neffs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;w=</span><span class="si">{</span><span class="mf">1e3</span><span class="o">*</span><span class="n">w</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">nm&quot;</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;λ [μm]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;neff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;λ v neff (for 3 widths)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">widths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">neffs</span> <span class="o">=</span> <span class="n">neff</span><span class="p">(</span><span class="n">wls</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">widths</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="n">neffs</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;w=</span><span class="si">{</span><span class="mf">1e3</span><span class="o">*</span><span class="n">w</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">nm&quot;</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">])</span>

<span class="nn">Cell In[22], line 4,</span> in <span class="ni">neff</span><span class="nt">(wl, width)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">wl0</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">dwl</span> <span class="o">=</span> <span class="n">wl</span> <span class="o">-</span> <span class="n">wl0</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">_neff0</span> <span class="o">=</span> <span class="n">neff0</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">_ng0</span> <span class="o">=</span> <span class="n">ng0</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">dneff_dwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">_ng0</span> <span class="o">-</span> <span class="n">_neff0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wl0</span>

<span class="nn">Cell In[21], line 2,</span> in <span class="ni">neff0</span><span class="nt">(width)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">neff0</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">m_neff</span> <span class="o">*</span> <span class="n">width</span> <span class="o">+</span> <span class="n">b_neff</span>

<span class="ne">NameError</span>: name &#39;m_neff&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We now have a model for our straight:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">straight</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="n">_neff</span> <span class="o">=</span> <span class="n">neff</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">_neff</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="n">wl</span>
    <span class="n">transmission</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">loss</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
    <span class="n">sdict</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o2&quot;</span><span class="p">):</span> <span class="n">transmission</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">sdict</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The convention in GDSFactory is to have optical ports starting with ‘o’: o1, o2, … It’s best to define our models with the same convention.</p>
</div>
</section>
<section id="euler-bend">
<h2>Euler Bend<a class="headerlink" href="#euler-bend" title="Link to this heading">#</a></h2>
<p>For this tutorial, let’s assume the <code class="docutils literal notranslate"><span class="pre">bend_euler</span></code> is exactly the same as the straight, but with a non-zero loss.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bend_euler</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">straight</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="heater">
<h2>Heater<a class="headerlink" href="#heater" title="Link to this heading">#</a></h2>
<p>A heater is often characterized by its <span class="math notranslate nohighlight">\(P_\pi\)</span>: the power needed to have a <span class="math notranslate nohighlight">\(\pi\)</span> phase shift. For the rest we’ll assume the same model as the straight:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">heater</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Ppi</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">wl0</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">dn_dP</span> <span class="o">=</span> <span class="n">wl0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">length</span> <span class="o">*</span> <span class="n">Ppi</span><span class="p">)</span>
    <span class="n">extra_phase</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="n">wl</span> <span class="o">*</span> <span class="n">dn_dP</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">*</span> <span class="n">extra_phase</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">straight</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mmi2x2">
<h2>MMI2x2<a class="headerlink" href="#mmi2x2" title="Link to this heading">#</a></h2>
<p>We can propose an MMI model that looks a bit like the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gplugins.sax.models</span> <span class="kn">import</span> <span class="n">_mmi_amp</span>


<span class="k">def</span> <span class="nf">mmi2x2</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sax</span><span class="o">.</span><span class="n">SDict</span><span class="p">:</span>
    <span class="n">wl0</span> <span class="o">=</span> <span class="mf">1.55</span>
    <span class="n">fwhm</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">loss_dB</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="mf">0.005</span>

    <span class="c1"># Convert splitting ratios from power to amplitude by taking the square root</span>
    <span class="n">amplitude_ratio_thru</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">amplitude_ratio_cross</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="n">loss_factor_thru</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">loss_dB</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">loss_factor_cross</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">loss_dB</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>

    <span class="n">thru</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">_mmi_amp</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">wl0</span><span class="o">=</span><span class="n">wl0</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span><span class="p">,</span> <span class="n">loss_dB</span><span class="o">=</span><span class="n">loss_dB</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">amplitude_ratio_thru</span>
        <span class="o">*</span> <span class="n">loss_factor_thru</span>
    <span class="p">)</span>
    <span class="n">cross</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">1</span><span class="n">j</span>
        <span class="o">*</span> <span class="n">_mmi_amp</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">wl0</span><span class="o">=</span><span class="n">wl0</span> <span class="o">+</span> <span class="n">shift</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span><span class="p">,</span> <span class="n">loss_dB</span><span class="o">=</span><span class="n">loss_dB</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">amplitude_ratio_cross</span>
        <span class="o">*</span> <span class="n">loss_factor_cross</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">sax</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">):</span> <span class="n">thru</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o4&quot;</span><span class="p">):</span> <span class="n">cross</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;o2&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">):</span> <span class="n">cross</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;o2&quot;</span><span class="p">,</span> <span class="s2">&quot;o4&quot;</span><span class="p">):</span> <span class="n">thru</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdict</span> <span class="o">=</span> <span class="n">mmi2x2</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5d2b9677412ce32e2403e71b47a323eac969c042b1b37cbce7d0c9ada05d6bac.png" src="_images/5d2b9677412ce32e2403e71b47a323eac969c042b1b37cbce7d0c9ada05d6bac.png" />
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>I once pulled this model out of my hat somewhere because I just wanted something that <em>kinda</em> looks like an MMI transfer curve. By now it has found its way into <code class="docutils literal notranslate"><span class="pre">gplugins</span></code> and other places. Please be careful which models you include in your libraries.</p>
</div>
</section>
<section id="simulate-mzi-with-heater">
<h2>Simulate: MZI with heater<a class="headerlink" href="#simulate-mzi-with-heater" title="Link to this heading">#</a></h2>
<p>Let’s have another look at our mzi with heater:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c_mzi1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2fbecb7875f8c92ff742264f36431c59f063eaf6c77e94a0c71c1c1762585bd8.png" src="_images/2fbecb7875f8c92ff742264f36431c59f063eaf6c77e94a0c71c1c1762585bd8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">netlist</span> <span class="o">=</span> <span class="n">c_mzi1</span><span class="o">.</span><span class="n">get_netlist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sax</span><span class="o">.</span><span class="n">get_required_circuit_models</span><span class="p">(</span><span class="n">netlist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;bend_euler&#39;, &#39;straight&#39;, &#39;straight_heater_metal_undercut&#39;, &#39;mmi2x2&#39;]
</pre></div>
</div>
</div>
</div>
<p>We should have all the four models of this circuit. Let’s get started.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;bend_euler&quot;</span><span class="p">:</span> <span class="n">bend_euler</span><span class="p">,</span>
    <span class="s2">&quot;straight&quot;</span><span class="p">:</span> <span class="n">straight</span><span class="p">,</span>
    <span class="s2">&quot;straight_heater_metal_undercut&quot;</span><span class="p">:</span> <span class="n">heater</span><span class="p">,</span>
    <span class="s2">&quot;mmi2x2&quot;</span><span class="p">:</span> <span class="n">mmi2x2</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">mzi1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">circuit</span><span class="p">(</span><span class="n">netlist</span><span class="o">=</span><span class="n">netlist</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="s2">&quot;bend_euler&quot;</span><span class="p">:</span> <span class="n">bend_euler</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="s2">&quot;straight&quot;</span><span class="p">:</span> <span class="n">straight</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;straight_heater_metal_undercut&quot;</span><span class="p">:</span> <span class="n">heater</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="s2">&quot;mmi2x2&quot;</span><span class="p">:</span> <span class="n">mmi2x2</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">}</span>
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="n">mzi1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">circuit</span><span class="p">(</span><span class="n">netlist</span><span class="o">=</span><span class="n">netlist</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">)</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/sax/circuit.py:76,</span> in <span class="ni">circuit</span><span class="nt">(netlist, models, backend, return_type, ignore_missing_ports)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span>     <span class="n">current_models</span> <span class="o">|=</span> <span class="n">new_models</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="n">new_models</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">---&gt; </span><span class="mi">76</span>     <span class="n">current_models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">circuit</span> <span class="o">=</span> <span class="n">_flat_circuit</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span>         <span class="n">flatnet</span><span class="o">.</span><span class="n">instances</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>         <span class="n">flatnet</span><span class="o">.</span><span class="n">connections</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span>         <span class="n">flatnet</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span>         <span class="n">current_models</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span>         <span class="n">backend</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">82</span>         <span class="n">ignore_missing_ports</span><span class="o">=</span><span class="n">ignore_missing_ports</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">83</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span> <span class="k">assert</span> <span class="n">circuit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">86</span> <span class="n">circuit</span> <span class="o">=</span> <span class="n">_enforce_return_type</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">return_type</span><span class="p">)</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/sax/circuit.py:168,</span> in <span class="ni">_flat_circuit</span><span class="nt">(instances, connections, ports, models, backend, ignore_missing_ports)</span>
<span class="g g-Whitespace">    </span><span class="mi">164</span> <span class="k">def</span> <span class="nf">_flat_circuit</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">165</span>     <span class="n">instances</span><span class="p">,</span> <span class="n">connections</span><span class="p">,</span> <span class="n">ports</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">ignore_missing_ports</span><span class="o">=</span><span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span>     <span class="n">analyze_insts_fn</span><span class="p">,</span> <span class="n">analyze_fn</span><span class="p">,</span> <span class="n">evaluate_fn</span> <span class="o">=</span> <span class="n">circuit_backends</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">168</span>     <span class="n">dummy_instances</span> <span class="o">=</span> <span class="n">analyze_insts_fn</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="n">models</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>     <span class="n">inst_port_mode</span> <span class="o">=</span> <span class="p">{</span>
<span class="nn">    170         k: _port_modes_dict(get_ports(s)) for k, s</span> in <span class="ni">dummy_instances.items</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>     <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>     <span class="n">connections</span> <span class="o">=</span> <span class="n">_get_multimode_connections</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">173</span>         <span class="n">connections</span><span class="p">,</span> <span class="n">inst_port_mode</span><span class="p">,</span> <span class="n">ignore_missing_ports</span><span class="o">=</span><span class="n">ignore_missing_ports</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span>     <span class="p">)</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/sax/backends/klu.py:32,</span> in <span class="ni">analyze_instances_klu</span><span class="nt">(instances, models)</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span>     <span class="n">model_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">component</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">32</span> <span class="n">dummy_models</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">scoo</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="n">k</span><span class="p">]())</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">dummy_instances</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/sax/backends/klu.py:32,</span> in <span class="ni">&lt;dictcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span>     <span class="n">model_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">component</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">32</span> <span class="n">dummy_models</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">scoo</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="n">k</span><span class="p">]())</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">dummy_instances</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

<span class="nn">Cell In[25], line 2,</span> in <span class="ni">bend_euler</span><span class="nt">(wl, width, length, loss)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">bend_euler</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">straight</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">)</span>

<span class="nn">Cell In[24], line 2,</span> in <span class="ni">straight</span><span class="nt">(wl, width, length, loss)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">straight</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">_neff</span> <span class="o">=</span> <span class="n">neff</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">_neff</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="n">wl</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">transmission</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">loss</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>

<span class="nn">Cell In[22], line 4,</span> in <span class="ni">neff</span><span class="nt">(wl, width)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">wl0</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">dwl</span> <span class="o">=</span> <span class="n">wl</span> <span class="o">-</span> <span class="n">wl0</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">_neff0</span> <span class="o">=</span> <span class="n">neff0</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">_ng0</span> <span class="o">=</span> <span class="n">ng0</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">dneff_dwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">_ng0</span> <span class="o">-</span> <span class="n">_neff0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wl0</span>

<span class="nn">Cell In[21], line 2,</span> in <span class="ni">neff0</span><span class="nt">(width)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">neff0</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">m_neff</span> <span class="o">*</span> <span class="n">width</span> <span class="o">+</span> <span class="n">b_neff</span>

<span class="ne">NameError</span>: name &#39;m_neff&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We can do an initial plot of this circuit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;thru&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o4&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;λ [nm]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;transmission&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">33</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">S</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;thru&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o4&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;mzi1&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="optimize-mzi-with-heater">
<h2>Optimize: MZI with heater<a class="headerlink" href="#optimize-mzi-with-heater" title="Link to this heading">#</a></h2>
<p>SAX is based on <a class="reference external" href="https://github.com/jax-ml/jax">JAX</a>, a machine learning framework from google. Therefore we can apply all the nice JAX machine learning optimization techniques to optimize our circuit. Let’s do a gradient based optimization on the input power of the heater to obtain no cross transmission at λ=1.55μm.</p>
<p>First, let’s define a loss function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>


<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.54</span><span class="p">,</span> <span class="n">heater</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="n">P</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span>  <span class="c1"># cross</span>
</pre></div>
</div>
</div>
</div>
<p>From the loss function we can define a gradient function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grad_fn</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span>
        <span class="n">loss_fn</span><span class="p">,</span>
        <span class="n">argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># JAX gradient function for the first positional argument, jitted</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> decorator on functions that you expect to run more than once. The first invocation of the decorated function will be slower but after that the execution becomes <em>blazingly fast</em>.</p>
</div>
<p>Next we initialize a JAX optimizer (adam optimizer):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jax.example_libraries.optimizers</span> <span class="kn">import</span> <span class="n">adam</span>

<span class="n">P_init</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">init_fn</span><span class="p">,</span> <span class="n">update_fn</span><span class="p">,</span> <span class="n">params_fn</span> <span class="o">=</span> <span class="n">adam</span><span class="p">(</span><span class="n">step_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">init_fn</span><span class="p">(</span><span class="n">P_init</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Given all this, a single training step can be defined:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">step_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">params_fn</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">grad_fn</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">update_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">state</span>
</pre></div>
</div>
</div>
</div>
<p>And we can use this step function to start the training of the MZI:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">trange</span>

<span class="n">range_</span> <span class="o">=</span> <span class="n">trange</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">best_state</span> <span class="o">=</span> <span class="n">state</span>
<span class="n">best_loss</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">inf</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">range_</span><span class="p">:</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">step_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">loss</span> <span class="o">&lt;</span> <span class="n">best_loss</span><span class="p">:</span>
        <span class="n">best_loss</span> <span class="o">=</span> <span class="n">loss</span>
        <span class="n">best_state</span> <span class="o">=</span> <span class="n">state</span>
    <span class="n">range_</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">best_loss</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "f7da34e7ad054e1d86586de456cad690"}</script><div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">best_loss</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">inf</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">range_</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">7</span>     <span class="n">loss</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">step_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="k">if</span> <span class="n">loss</span> <span class="o">&lt;</span> <span class="n">best_loss</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>         <span class="n">best_loss</span> <span class="o">=</span> <span class="n">loss</span>

<span class="nn">Cell In[37], line 3,</span> in <span class="ni">step_fn</span><span class="nt">(step, state)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">step_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">settings</span> <span class="o">=</span> <span class="n">params_fn</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">grad</span> <span class="o">=</span> <span class="n">grad_fn</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">state</span> <span class="o">=</span> <span class="n">update_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="p">[</span><span class="o">...</span> <span class="n">skipping</span> <span class="n">hidden</span> <span class="mi">11</span> <span class="n">frame</span><span class="p">]</span>

<span class="nn">Cell In[34], line 6,</span> in <span class="ni">loss_fn</span><span class="nt">(P)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">6</span>     <span class="n">S</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.54</span><span class="p">,</span> <span class="n">heater</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="n">P</span><span class="p">})</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;mzi1&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="n">params_fn</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="n">P</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>Let’s see what we’ve got over a range of wavelengths:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;thru&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o4&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;λ [nm]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;transmission&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1540</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">40</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">S</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;thru&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o4&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;mzi1&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Even though we can use all these nice gradient-based optimization techniques from JAX, they might not be the best way to optimize a photonic circuit: it’s very easy to get stuck in local minima (try for example optimizing the cross transmission in the above example). It’s however very easy to use alternative optimization techniques as well.</p>
</div>
</section>
<section id="alternative-optimization-optimization-of-the-mzi-with-heater-with-scipy-minimize">
<h2>Alternative Optimization: optimization of the mzi with heater with scipy.minimize<a class="headerlink" href="#alternative-optimization-optimization-of-the-mzi-with-heater-with-scipy-minimize" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss_fn</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,))</span>

<span class="n">P0</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
<span class="n">S0</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S0</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;thru&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S0</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o4&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;λ [nm]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;transmission&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1540</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">result</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss_fn</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">P0</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">S0</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P0</span><span class="p">)</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/scipy/optimize/_minimize.py:726,</span> in <span class="ni">minimize</span><span class="nt">(fun, x0, args, method, jac, hess, hessp, bounds, constraints, tol, callback, options)</span>
<span class="g g-Whitespace">    </span><span class="mi">724</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">_minimize_cg</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">725</span> <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;bfgs&#39;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">726</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">_minimize_bfgs</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">727</span> <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;newton-cg&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">728</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">_minimize_newtoncg</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">hess</span><span class="p">,</span> <span class="n">hessp</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">729</span>                              <span class="o">**</span><span class="n">options</span><span class="p">)</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/scipy/optimize/_optimize.py:1371,</span> in <span class="ni">_minimize_bfgs</span><span class="nt">(fun, x0, args, jac, callback, gtol, norm, eps, maxiter, disp, return_all, finite_diff_rel_step, xrtol, c1, c2, hess_inv0, **unknown_options)</span>
<span class="g g-Whitespace">   </span><span class="mi">1368</span> <span class="k">if</span> <span class="n">maxiter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1369</span>     <span class="n">maxiter</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">200</span>
<span class="ne">-&gt; </span><span class="mi">1371</span> <span class="n">sf</span> <span class="o">=</span> <span class="n">_prepare_scalar_function</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1372</span>                               <span class="n">finite_diff_rel_step</span><span class="o">=</span><span class="n">finite_diff_rel_step</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1374</span> <span class="n">f</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">fun</span>
<span class="g g-Whitespace">   </span><span class="mi">1375</span> <span class="n">myfprime</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">grad</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/scipy/optimize/_optimize.py:288,</span> in <span class="ni">_prepare_scalar_function</span><span class="nt">(fun, x0, jac, args, bounds, epsilon, finite_diff_rel_step, hess)</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span>     <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span> <span class="c1"># ScalarFunction caches. Reuse of fun(x) during grad</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span> <span class="c1"># calculation reduces overall function evaluations.</span>
<span class="ne">--&gt; </span><span class="mi">288</span> <span class="n">sf</span> <span class="o">=</span> <span class="n">ScalarFunction</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">hess</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">289</span>                     <span class="n">finite_diff_rel_step</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">291</span> <span class="k">return</span> <span class="n">sf</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/scipy/optimize/_differentiable_functions.py:222,</span> in <span class="ni">ScalarFunction.__init__</span><span class="nt">(self, fun, x0, args, grad, hess, finite_diff_rel_step, finite_diff_bounds, epsilon)</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>     <span class="n">finite_diff_options</span><span class="p">[</span><span class="s2">&quot;as_linear_operator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span> <span class="c1"># Initial function evaluation</span>
<span class="ne">--&gt; </span><span class="mi">222</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_fun</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span> <span class="c1"># Initial gradient evaluation</span>
<span class="g g-Whitespace">    </span><span class="mi">225</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_grad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngev</span> <span class="o">=</span> <span class="n">_wrapper_grad</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">226</span>     <span class="n">grad</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>     <span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_fun</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>     <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span>     <span class="n">finite_diff_options</span><span class="o">=</span><span class="n">finite_diff_options</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span> <span class="p">)</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/scipy/optimize/_differentiable_functions.py:294,</span> in <span class="ni">ScalarFunction._update_fun</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">292</span> <span class="k">def</span> <span class="nf">_update_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">293</span>     <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_updated</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">294</span>         <span class="n">fx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_fun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">295</span>         <span class="k">if</span> <span class="n">fx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lowest_f</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">296</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_lowest_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/scipy/optimize/_differentiable_functions.py:20,</span> in <span class="ni">_wrapper_fun.&lt;locals&gt;.wrapped</span><span class="nt">(x)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">ncalls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="c1"># Send a copy because the user may overwrite it.</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="c1"># Overwriting results in undefined behaviour because</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="c1"># fun(self.x) will change self.x, with the two no longer linked.</span>
<span class="ne">---&gt; </span><span class="mi">20</span> <span class="n">fx</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="c1"># Make sure the function returns a true scalar</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">fx</span><span class="p">):</span>

    <span class="p">[</span><span class="o">...</span> <span class="n">skipping</span> <span class="n">hidden</span> <span class="mi">11</span> <span class="n">frame</span><span class="p">]</span>

<span class="nn">Cell In[34], line 6,</span> in <span class="ni">loss_fn</span><span class="nt">(P)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">6</span>     <span class="n">S</span> <span class="o">=</span> <span class="n">mzi1</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.54</span><span class="p">,</span> <span class="n">heater</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="n">P</span><span class="p">})</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;mzi1&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="monte-carlo-simulation-of-the-mzi">
<h2>Monte Carlo Simulation of the MZI<a class="headerlink" href="#monte-carlo-simulation-of-the-mzi" title="Link to this heading">#</a></h2>
<p>As you probably recall, our waveguide model supports a waveguide width. We can simulate some process variations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">RandomState</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">sigma_width</span> <span class="o">=</span> <span class="mf">0.03</span> <span class="o">/</span> <span class="mf">3.0</span>  <span class="c1"># 3sigma = 30nm</span>
<span class="n">widths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma_width</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="o">%</span><span class="k">time</span> S = mzi1(wl=wls[:, None], width=widths[None, :], P=P0) # See Extra: broadcasting in python
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S0</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">File</span> <span class="o">&lt;</span><span class="n">timed</span> <span class="n">exec</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span>

<span class="ne">NameError</span>: name &#39;mzi1&#39; is not defined
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">42</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">widths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma_width</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;S = mzi1(wl=wls[:, None], width=widths[None, :], P=P0) # See Extra: broadcasting in python&#39;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S0</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="ne">KeyError</span>: (&#39;o1&#39;, &#39;o3&#39;)
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Did you see what happened there? The mzi1 call <em>broadcasted</em> the <code class="docutils literal notranslate"><span class="pre">mx1</span></code> array <code class="docutils literal notranslate"><span class="pre">wls[:,</span> <span class="pre">None]</span></code> with the <code class="docutils literal notranslate"><span class="pre">1xn</span></code> array <code class="docutils literal notranslate"><span class="pre">widths[None,</span> <span class="pre">:]</span></code> into an Sdict with <code class="docutils literal notranslate"><span class="pre">mxn</span></code> arrays as entries. We basically did two perpendicular parameter sweeps (<code class="docutils literal notranslate"><span class="pre">wl</span></code> and <code class="docutils literal notranslate"><span class="pre">width</span></code>) at once! This is the most efficient way to perform Monte Carlo simulations with SAX.</p>
<p>To understand more about broadcasting read <a class="reference internal" href="#extra-broadcasting-in-python"><span class="xref myst">the next section</span></a>.</p>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="extra-broadcasting-in-python">
<h1>Extra: broadcasting in python<a class="headerlink" href="#extra-broadcasting-in-python" title="Link to this heading">#</a></h1>
<section id="indexing-with-none">
<h2>Indexing with None<a class="headerlink" href="#indexing-with-none" title="Link to this heading">#</a></h2>
<p>The first thing we need to understand is ‘indexing with <code class="docutils literal notranslate"><span class="pre">None</span></code>’. This is best explained with an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="p">[:,</span><span class="w"> </span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="p">[:,</span><span class="w"> </span><span class="p">:,</span><span class="w"> </span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x.shape=(3, 4)
x[None].shape=(1, 3, 4)
x[:, None].shape=(3, 1, 4)
x[:, :, None].shape=(3, 4, 1)
</pre></div>
</div>
</div>
</div>
<p>Indexing with <code class="docutils literal notranslate"><span class="pre">None</span></code> hence adds an extra dimension at the index location of the <code class="docutils literal notranslate"><span class="pre">None</span></code>. The extra dimension has size 1.</p>
</section>
<section id="broadcasting-dimensions-with-size-1">
<h2>Broadcasting dimensions with size 1<a class="headerlink" href="#broadcasting-dimensions-with-size-1" title="Link to this heading">#</a></h2>
<p>Dimensions with size 1 can always be <em>broadcasted</em> to the size of the matching dimension of another array in the same operation. This is also best explained with an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">            | </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="p">:]</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2"> | </span><span class="si">{</span><span class="n">y</span><span class="p">[:,</span><span class="w"> </span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="p">:]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">[:,</span><span class="w"> </span><span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x.shape=(3,)            | y.shape=(4,)
x[None, :].shape=(1, 3) | y[:, None].shape=(4, 1)
(x[None, :] + y[:, None]).shape=(4, 3)
</pre></div>
</div>
</div>
</div>
<p>There is also a <code class="docutils literal notranslate"><span class="pre">jnp.broadcast_to()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x=[0 1 2 3]
y=[[0 1 2 3]
 [0 1 2 3]
 [0 1 2 3]
 [0 1 2 3]
 [0 1 2 3]
 [0 1 2 3]
 [0 1 2 3]
 [0 1 2 3]
 [0 1 2 3]
 [0 1 2 3]]
</pre></div>
</div>
</div>
</div>
<p>As you can see, when an array is broadcasted along a dimension with size 1, the array gets repeated along that dimension.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>broadcasting along a dimension with size bigger than 1 does <strong>not</strong> work.</p>
</div>
</section>
<section id="hierarchical-circuits">
<h2>Hierarchical circuits<a class="headerlink" href="#hierarchical-circuits" title="Link to this heading">#</a></h2>
<p>You can also simulate hierarchical circuits, such as lattice of MZI interferometers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@gf</span><span class="o">.</span><span class="n">cell</span>
<span class="k">def</span> <span class="nf">create_mzis</span><span class="p">(</span><span class="n">delta_length1</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">delta_length2</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">mzi_with_heater</span><span class="p">(</span><span class="n">delta_length</span><span class="o">=</span><span class="n">delta_length1</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">mzi_with_heater</span><span class="p">(</span><span class="n">delta_length</span><span class="o">=</span><span class="n">delta_length2</span><span class="p">))</span><span class="o">.</span><span class="n">dmove</span><span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_single</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">port1</span><span class="o">=</span><span class="n">c1</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">],</span> <span class="n">port2</span><span class="o">=</span><span class="n">c2</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span> <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;strip&quot;</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add_ports</span><span class="p">([</span><span class="n">c1</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span> <span class="n">c1</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">],</span> <span class="n">c2</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">],</span> <span class="n">c2</span><span class="p">[</span><span class="s2">&quot;o4&quot;</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c_mzis</span> <span class="o">=</span> <span class="n">create_mzis</span><span class="p">()</span>
<span class="n">c_mzis</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e801364367979b00aef11ddf9c4cbdc2397830442034750c2a9f66a9e82ef96e.png" src="_images/e801364367979b00aef11ddf9c4cbdc2397830442034750c2a9f66a9e82ef96e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">netlist</span> <span class="o">=</span> <span class="n">c_mzis</span><span class="o">.</span><span class="n">get_netlist</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mzis</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">circuit</span><span class="p">(</span><span class="n">netlist</span><span class="o">=</span><span class="n">netlist</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">mzis</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o3&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1 MZI&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wls</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">,</span> <span class="s2">&quot;o4&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1 MZI&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;λ [nm]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">48</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">netlist</span> <span class="o">=</span> <span class="n">c_mzis</span><span class="o">.</span><span class="n">get_netlist</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">mzis</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sax</span><span class="o">.</span><span class="n">circuit</span><span class="p">(</span><span class="n">netlist</span><span class="o">=</span><span class="n">netlist</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">S</span> <span class="o">=</span> <span class="n">mzis</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wls</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/sax/circuit.py:76,</span> in <span class="ni">circuit</span><span class="nt">(netlist, models, backend, return_type, ignore_missing_ports)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span>     <span class="n">current_models</span> <span class="o">|=</span> <span class="n">new_models</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="n">new_models</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">---&gt; </span><span class="mi">76</span>     <span class="n">current_models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">circuit</span> <span class="o">=</span> <span class="n">_flat_circuit</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span>         <span class="n">flatnet</span><span class="o">.</span><span class="n">instances</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>         <span class="n">flatnet</span><span class="o">.</span><span class="n">connections</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span>         <span class="n">flatnet</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span>         <span class="n">current_models</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span>         <span class="n">backend</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">82</span>         <span class="n">ignore_missing_ports</span><span class="o">=</span><span class="n">ignore_missing_ports</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">83</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span> <span class="k">assert</span> <span class="n">circuit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">86</span> <span class="n">circuit</span> <span class="o">=</span> <span class="n">_enforce_return_type</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">return_type</span><span class="p">)</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/sax/circuit.py:168,</span> in <span class="ni">_flat_circuit</span><span class="nt">(instances, connections, ports, models, backend, ignore_missing_ports)</span>
<span class="g g-Whitespace">    </span><span class="mi">164</span> <span class="k">def</span> <span class="nf">_flat_circuit</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">165</span>     <span class="n">instances</span><span class="p">,</span> <span class="n">connections</span><span class="p">,</span> <span class="n">ports</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">ignore_missing_ports</span><span class="o">=</span><span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span>     <span class="n">analyze_insts_fn</span><span class="p">,</span> <span class="n">analyze_fn</span><span class="p">,</span> <span class="n">evaluate_fn</span> <span class="o">=</span> <span class="n">circuit_backends</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">168</span>     <span class="n">dummy_instances</span> <span class="o">=</span> <span class="n">analyze_insts_fn</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="n">models</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>     <span class="n">inst_port_mode</span> <span class="o">=</span> <span class="p">{</span>
<span class="nn">    170         k: _port_modes_dict(get_ports(s)) for k, s</span> in <span class="ni">dummy_instances.items</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>     <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>     <span class="n">connections</span> <span class="o">=</span> <span class="n">_get_multimode_connections</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">173</span>         <span class="n">connections</span><span class="p">,</span> <span class="n">inst_port_mode</span><span class="p">,</span> <span class="n">ignore_missing_ports</span><span class="o">=</span><span class="n">ignore_missing_ports</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span>     <span class="p">)</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/sax/backends/klu.py:32,</span> in <span class="ni">analyze_instances_klu</span><span class="nt">(instances, models)</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span>     <span class="n">model_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">component</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">32</span> <span class="n">dummy_models</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">scoo</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="n">k</span><span class="p">]())</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">dummy_instances</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

<span class="nn">File ~/work/sax-workshop/sax-workshop/.venv/lib/python3.11/site-packages/sax/backends/klu.py:32,</span> in <span class="ni">&lt;dictcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span>     <span class="n">model_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">component</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">32</span> <span class="n">dummy_models</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">scoo</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="n">k</span><span class="p">]())</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">dummy_instances</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

<span class="nn">Cell In[25], line 2,</span> in <span class="ni">bend_euler</span><span class="nt">(wl, width, length, loss)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">bend_euler</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">straight</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">)</span>

<span class="nn">Cell In[24], line 2,</span> in <span class="ni">straight</span><span class="nt">(wl, width, length, loss)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">straight</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">_neff</span> <span class="o">=</span> <span class="n">neff</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">_neff</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="n">wl</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">transmission</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">loss</span> <span class="o">*</span> <span class="n">length</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>

<span class="nn">Cell In[22], line 4,</span> in <span class="ni">neff</span><span class="nt">(wl, width)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">wl0</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">dwl</span> <span class="o">=</span> <span class="n">wl</span> <span class="o">-</span> <span class="n">wl0</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">_neff0</span> <span class="o">=</span> <span class="n">neff0</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">_ng0</span> <span class="o">=</span> <span class="n">ng0</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">dneff_dwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">_ng0</span> <span class="o">-</span> <span class="n">_neff0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wl0</span>

<span class="nn">Cell In[21], line 2,</span> in <span class="ni">neff0</span><span class="nt">(width)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">neff0</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">m_neff</span> <span class="o">*</span> <span class="n">width</span> <span class="o">+</span> <span class="n">b_neff</span>

<span class="ne">NameError</span>: name &#39;m_neff&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Sax Workshop</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scatter-dictionaries">Scatter <em>dictionaries</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-model-the-coupler">A first Model: the coupler</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-second-model-the-straight-waveguide">A second model: the straight waveguide</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-circuit-the-simple-mzi">A first circuit: the simple mzi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-simulation-wavelength-sweep-of-the-simple-mzi">A first simulation: wavelength sweep of the simple mzi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-layout-mzi-with-heater">A first layout: MZI with heater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-better-waveguide-model">A better waveguide model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#euler-bend">Euler Bend</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#heater">Heater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mmi2x2">MMI2x2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-mzi-with-heater">Simulate: MZI with heater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimize-mzi-with-heater">Optimize: MZI with heater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-optimization-optimization-of-the-mzi-with-heater-with-scipy-minimize">Alternative Optimization: optimization of the mzi with heater with scipy.minimize</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-simulation-of-the-mzi">Monte Carlo Simulation of the MZI</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-broadcasting-in-python">Extra: broadcasting in python</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-with-none">Indexing with None</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#broadcasting-dimensions-with-size-1">Broadcasting dimensions with size 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-circuits">Hierarchical circuits</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Floris Laporte
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>